<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Default model &#8212; DIY ML Climate Model</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css?v=34905f61" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Default model fixed structure" href="VAE.html" />
    <link rel="prev" title="A DIY Machine Learning Climate Model" href="../index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="VAE.html" title="Default model fixed structure"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="A DIY Machine Learning Climate Model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">DCVAE-Climate</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Default model</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="default-model">
<h1>Default model<a class="headerlink" href="#default-model" title="Link to this heading">¶</a></h1>
<p>The purpose of the model, is to learn a generator function that makes climate states (monthly fields of temperature, pressure and precipitation) with a low-dimensional state vector (embedding) as input. This generator is the climate model that e will use for experiments. To learn that model (and embedding) a standard tool in ML - a factory for learning such functions from example climate states.</p>
<p>The factory is a Deep Convolutional <a class="reference external" href="https://en.wikipedia.org/wiki/Variational_autoencoder">Variational Autoencoder</a>. It takes <a class="reference internal" href="make_dataset.html"><span class="doc">input data</span></a> on a 721x1440 grid (same as ERA5), and uses a pair of convolutional neural nets to encode and decode the data - learning to both produce a target output on the same grid and make the encoded version (the embedding) distributed as a unit normal. The <a class="reference internal" href="VAE.html"><span class="doc">structure of the model</span></a> (12 convolutional layers in the encoder, 11 in the decoder) is fixed, but input and output data, and the hyperparameters (learning rate, batch size, beta, etc) can be changed. They are set in a <a class="reference internal" href="specify.html"><span class="doc">specification file</span></a> (<cite>specify.py</cite>).</p>
<figure class="align-center" id="id2" style="width: 95%">
<a class="reference internal image-reference" href="../_images/Slide3.PNG"><img alt="../_images/Slide3.PNG" src="../_images/Slide3.PNG" style="width: 95%;" />
</a>
<figcaption>
<p><span class="caption-text">The structure of the VAE used to train the generator</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>We will code the DCVAE using the <cite>TensorFlow &lt;https://www.tensorflow.org/&gt;</cite> platform. The big advantage of TensorFlow is that a lot of the work has been done for us: The model structure is a subclass of <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/Model">tf.keras.Model</a>, and there is an <a class="reference external" href="https://www.tensorflow.org/tutorials/generative/cvae">example of a VAE</a> in the TensorFlow documentation which we can build upon. Building on that, we can specify a DCVAE class for our climate data:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="VAE.html">Model structure</a></li>
</ul>
</div>
<p>The model is trained on monthly fields of temperature, pressure and precipitation. We have <a class="reference internal" href="../get_data/index.html"><span class="doc">taken these fields from ERA5</span></a>, and <a class="reference internal" href="../normalization/index.html"><span class="doc">converted and normalised them</span></a> already. What remains is to package them for input to the DCVAE. Training the DCVAE will mean we need to access the fields repeatedly and fast, and TensorFlow has software tools optimized for exactly this use: We will use the <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset">tf.data.Dataset</a> class to present the training data to the DCVAE.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="make_dataset.html">Input Datasets</a></li>
</ul>
</div>
<p>To run the model, we need to specify the model inputs, outputs and hyperparameters. This is done in a specification file. Copy the specification file (<cite>specify.py</cite>) and the model training script to a new directory, and edit the specification file to suit your needs. Then run the training script (<cite>autoencoder.py</cite>).</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="specify.html">Specification file</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training script</a></li>
</ul>
</div>
<p>And to test the training success there are scripts for plotting the training history and for testing the model on a test dataset.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="plot_history.html">Plot training_history</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validate on single month</a></li>
<li class="toctree-l1"><a class="reference internal" href="validate_multi.html">Validate on time-series</a></li>
</ul>
</div>
<p>Those scripts train and test the AutoEncoder. We are using a <a class="reference external" href="https://en.wikipedia.org/wiki/Variational_autoencoder">Variational Autoencoder</a>, because we want to be able to use its generator as a climate model, and particularly to <a class="reference external" href="https://brohan.org/Proxy_20CR">assimilate data into it</a>.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="assimilation.html">Assimilate a single month</a></li>
<li class="toctree-l1"><a class="reference internal" href="assimilate_multi.html">Assimilate a time-series</a></li>
</ul>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DIY_Climate.png" alt="Logo of A Machine Learning Climate Model based on a Deep Convolutional Variational AutoEncoder"/>
            </a></p>
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Detailed specification of the ML model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_data/index.html">How to download the training data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../normalization/index.html">How to convert and normalize the data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specify.html">Specify the details of the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="make_dataset.html">Assemble the normalized data into training and test datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Train the model</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">Utility functions for plotting and regridding</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to.html">How to reproduce or extend this work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Authors and acknowledgements</a></li>
</ul>
<h3><a href="https://github.com/philip-brohan/DCVAE_Climate">Get a copy</a></h3>

<ul>
    <li><a href="https://github.com/philip-brohan/DCVAE_Climate" rel="nofollow">Github repository</a></li>
</ul>

<h3>Found a bug, or have a suggestion?</h3>

Please <a href="https://github.com/philip-brohan/DCVAE_Climate/issues/new">raise an issue</a>.
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="VAE.html" title="Default model fixed structure"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="A DIY Machine Learning Climate Model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">DCVAE-Climate</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Default model</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>